{
  "name": "Spiffy Telegram Airtable Workflow",
  "nodes": [
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {}
      },
      "id": "9a0988cc-08f2-4eec-9e64-591cf50cf248",
      "name": "Telegram Trigger",
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1,
      "position": [
        -976,
        112
      ],
      "webhookId": "78851333-0f21-45e3-a220-97a46b2e8867",
      "credentials": {
        "telegramApi": {
          "id": "ZVzTrMIuVWfKbh71",
          "name": "Spiffy-Telegram"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const msg = $json.message || {};\nconst text = String(msg.text || '').trim();\nconst chatId = msg.chat.id;\n\nlet command = '';\nlet args = '';\nconst lower = text.toLowerCase();\n\nif (lower.startsWith('list')) command = 'list';\nelse if (lower.startsWith('status')) command = 'status';\nelse if (lower.startsWith('help')) command = 'help';\nelse if (lower.startsWith('add ')) { command = 'add'; args = text.slice(4).trim(); }\nelse if (lower.startsWith('switch ')) { command = 'switch'; args = text.slice(7).trim(); }\nelse if (lower.startsWith('remember')) { command = 'remember'; args = text.slice(8).trim(); } // args = optional topic or hint\n\nconst isCommand = Boolean(command);\n\nreturn [{ json: { text, chatId, command: command || 'help', args, isCommand } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -832,
        112
      ],
      "id": "45ceaf07-c549-4db0-9f3f-6c7304d042f8",
      "name": "Parse Message"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{$json.command}}",
                    "rightValue": "list",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "ee99eb85-4b3b-4ee5-8d7f-4cfcd40bc79a"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "5fc466fe-42e6-4d83-9392-453439c31fd4",
                    "leftValue": "={{$json.command}}",
                    "rightValue": "status",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "32624891-85af-4724-a4e8-b173510908ee",
                    "leftValue": "={{$json.command}}",
                    "rightValue": "help",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "948b2ee7-e715-4f03-983f-b0fb2fd87d13",
                    "leftValue": "={{$json.command}}",
                    "rightValue": "add",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "1cf144f2-e2f0-4ee5-bcb8-bad52131ddcd",
                    "leftValue": "={{$json.command}}",
                    "rightValue": "switch",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "3fe106c8-0cd0-4cf4-8d2b-aac57bdfd72c",
                    "leftValue": "={{$json.command}}",
                    "rightValue": "remember",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -416,
        -64
      ],
      "id": "3a7137f2-506e-469c-885b-1401ba4d507a",
      "name": "Switch"
    },
    {
      "parameters": {
        "operation": "search",
        "base": {
          "__rl": true,
          "value": "appTxK7lxuhWmaadj",
          "mode": "id"
        },
        "table": {
          "__rl": true,
          "value": "tblPLINlA3kuBi5dd",
          "mode": "list",
          "cachedResultName": "Commands",
          "cachedResultUrl": "https://airtable.com/appTxK7lxuhWmaadj/tblPLINlA3kuBi5dd"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        96,
        -416
      ],
      "id": "d849facd-e7dc-4366-a8a2-f6790a67bb93",
      "name": "Airtable: List Commands",
      "credentials": {
        "airtableTokenApi": {
          "id": "yfOqFYwVkXZmE1LS",
          "name": "Airtable Personal Access Token account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const cmd = $json.command;\nlet message = 'Need help? Try: list, add <task>, switch <name>, status';\nif (cmd === 'status') message = 'Spiffy is alive. Airtable connected.';\nif (cmd === 'help') message = 'Commands: list, add <task>, switch <name>, status';\n\nreturn [{ json: { message, chatId: $json.chatId } }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        384,
        -272
      ],
      "id": "6e0f178b-f777-49b6-a5e4-3e7860321f59",
      "name": "Format Help/Status"
    },
    {
      "parameters": {
        "operation": "create",
        "base": {
          "__rl": true,
          "value": "appTxK7lxuhWmaadj",
          "mode": "id"
        },
        "table": {
          "__rl": true,
          "value": "tblovPAlFPf5T7JUj",
          "mode": "list",
          "cachedResultName": "Tasks",
          "cachedResultUrl": "https://airtable.com/appTxK7lxuhWmaadj/tblovPAlFPf5T7JUj"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Task": "={{$json.parsed.task || $json.args || 'New task'}}",
            "Status": "Not Started",
            "Priority": "={{$json.parsed.priority || 'Medium'}}",
            "Due Date": "={{$json.parsed.due || $moment().format('YYYY-MM-DD')}}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Task",
              "displayName": "Task",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "options",
              "options": [
                {
                  "name": "Not Started",
                  "value": "Not Started"
                },
                {
                  "name": "In Progress",
                  "value": "In Progress"
                },
                {
                  "name": "Done",
                  "value": "Done"
                }
              ],
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Priority",
              "displayName": "Priority",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "options",
              "options": [
                {
                  "name": "Low",
                  "value": "Low"
                },
                {
                  "name": "Med",
                  "value": "Med"
                },
                {
                  "name": "High",
                  "value": "High"
                }
              ],
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Due Date",
              "displayName": "Due Date",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "dateTime",
              "readOnly": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        224,
        -144
      ],
      "id": "275fbcfb-836e-4e96-b961-49e135a1d7e4",
      "name": "Airtable: Create Task",
      "credentials": {
        "airtableTokenApi": {
          "id": "yfOqFYwVkXZmE1LS",
          "name": "Airtable Personal Access Token account"
        }
      }
    },
    {
      "parameters": {
        "operation": "search",
        "base": {
          "__rl": true,
          "value": "appTxK7lxuhWmaadj",
          "mode": "id"
        },
        "table": {
          "__rl": true,
          "value": "tbl4frYApXVg65Xkz",
          "mode": "list",
          "cachedResultName": "Personality",
          "cachedResultUrl": "https://airtable.com/appTxK7lxuhWmaadj/tbl4frYApXVg65Xkz"
        },
        "filterByFormula": "={{ \"LOWER({Name}) = LOWER('\" + $json.args.trim() + \"')\" }}",
        "options": {}
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        224,
        0
      ],
      "id": "8792665a-3b7d-40b6-88d9-b81355426c83",
      "name": "Airtable: Find Personality",
      "credentials": {
        "airtableTokenApi": {
          "id": "yfOqFYwVkXZmE1LS",
          "name": "Airtable Personal Access Token account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Safely fetch chatId\nconst pm = $items('Parse Message', 0, 0);\nconst chatId =\n  (pm && pm[0] && pm[0].json && pm[0].json.chatId) ||\n  $json.chatId ||\n  null;\n\n// Airtable returns flattened fields when Simplify = ON\nconst rec = items[0]?.json;\n\nif (!rec) {\n  const name = ($json.args || '').trim() || '(none)';\n  return [{ json: { message: `Personality '${name}' not found.`, chatId } }];\n}\n\n// Normal successful switch\nreturn [{\n  json: {\n    message: `Switched to: ${rec.Name}\\nMood: ${rec.Mood}`,\n    chatId,\n    personality: rec.Name,\n    promptStyle: rec['Prompt Style'] || null,\n    mood: rec.Mood || null\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        480,
        -16
      ],
      "id": "110b5397-11bf-410f-98d0-9cd000fc4fe4",
      "name": "Format Switch Personality"
    },
    {
      "parameters": {
        "operation": "create",
        "base": {
          "__rl": true,
          "value": "appTxK7lxuhWmaadj",
          "mode": "list",
          "cachedResultName": "Spiffy OS",
          "cachedResultUrl": "https://airtable.com/appTxK7lxuhWmaadj"
        },
        "table": {
          "__rl": true,
          "value": "tblqcjZpU2VFD3rTY",
          "mode": "list",
          "cachedResultName": "Logs (chat I/O)",
          "cachedResultUrl": "https://airtable.com/appTxK7lxuhWmaadj/tblqcjZpU2VFD3rTY"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": false
            },
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": false
            },
            {
              "id": "input",
              "displayName": "input",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "output",
              "displayName": "output",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "tags",
              "displayName": "tags",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "array",
              "options": [
                {
                  "name": "funny",
                  "value": "funny"
                },
                {
                  "name": "technical",
                  "value": "technical"
                },
                {
                  "name": "error",
                  "value": "error"
                },
                {
                  "name": "rebook",
                  "value": "rebook"
                },
                {
                  "name": "webhook",
                  "value": "webhook"
                }
              ],
              "readOnly": false,
              "removed": false
            },
            {
              "id": "source",
              "displayName": "source",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        -576,
        -48
      ],
      "id": "fe3353b0-fbd7-4377-a9a7-e6b714d7856b",
      "name": "Airtable: Log (In)",
      "credentials": {
        "airtableTokenApi": {
          "id": "yfOqFYwVkXZmE1LS",
          "name": "Airtable Personal Access Token account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Safely fetch chatId from \"Parse Message\" (works even if this node is executed alone)\nconst pm = $items('Parse Message', 0, 0);\nconst chatId =\n  (pm && pm[0] && pm[0].json && pm[0].json.chatId) ||\n  $json.chatId ||\n  null;\n\n// Airtable Create Task returns the created record (with Simplify ON, fields are flat)\nconst rec = $json.fields || $json;\nconst task = rec.Task || '(no task)';\n\nreturn [{\n  json: {\n    message: `âœ… Created task: ${task}`,\n    chatId\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        480,
        -144
      ],
      "id": "e1a4b178-1b98-44dd-a593-91bfffcd8d3d",
      "name": "Format Task Created"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{$json.isCommand}}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    },
                    "id": "1bd1cd2f-ec36-4e21-9022-1858bf68b4c3"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Command Branch"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "bc0185ca-68e9-47d9-b21e-45e33800bf0f",
                    "leftValue": "={{$json.isCommand}}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "false",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Conversation Branch"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -592,
        176
      ],
      "id": "e4f60a64-4ec4-40a1-bdb8-3c04f326a5b2",
      "name": "Route Kind"
    },
    {
      "parameters": {
        "operation": "sendChatAction",
        "chatId": "={{$json.chatId}}"
      },
      "id": "ec8c163d-8963-4e86-b0a3-af26c08583cc",
      "name": "Send Chat Action (typing)",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        -592,
        384
      ],
      "webhookId": "1554cc2c-ee48-484a-9001-1815445a37c2",
      "credentials": {
        "telegramApi": {
          "id": "ZVzTrMIuVWfKbh71",
          "name": "Spiffy-Telegram"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://ollama:11434/api/chat",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"model\": \"spiffy:latest\",\n  \"messages\": [\n    {\n      \"role\": \"user\",\n      \"content\": \"Relevant memory:\\n{{ ($json.memoryContext || '').replace(/\\\\/g,'\\\\\\\\').replace(/\\\"/g,'\\\\\\\"').replace(/\\n/g,'\\\\n') }}\\n\\nUser message:\\n{{ ($json.text || '').replace(/\\\\/g,'\\\\\\\\').replace(/\\\"/g,'\\\\\\\"').replace(/\\n/g,'\\\\n') }}\"\n    }\n  ],\n  \"stream\": false,\n  \"options\": { \"keep_alive\": \"2h\", \"num_thread\": 4 }\n}",
        "options": {
          "timeout": 240000
        }
      },
      "id": "1855261c-3c72-434b-a7ae-cdde17a43981",
      "name": "HTTP â†’ Ollama (chat)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [
        96,
        272
      ],
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "keepOnlySet": true,
        "values": {
          "string": [
            {
              "name": "reply",
              "value": "={{ $json.response ? $json.response : ($json.message && $json.message.content ? $json.message.content : ($json.choices && $json.choices[0] && $json.choices[0].message && $json.choices[0].message.content ? $json.choices[0].message.content : '')) }}"
            }
          ]
        },
        "options": {}
      },
      "id": "7d74cdcb-bb1c-41c3-92c4-dcaf17193b1c",
      "name": "Set â†’ reply",
      "type": "n8n-nodes-base.set",
      "typeVersion": 2,
      "position": [
        352,
        272
      ]
    },
    {
      "parameters": {
        "jsCode": "// Split long replies into Telegram-safe chunks (~4096 char limit).\n// We keep a safety margin for emojis/markup.\nconst MAX = 3500;\n\n// Helper: smart split near a paragraph/sentence/space boundary\nfunction splitSmart(text, max) {\n  const out = [];\n  let rest = text || \"\";\n  while (rest.length > max) {\n    const slice = rest.slice(0, max + 1);\n    // prefer paragraph break, then sentence, then newline, then space\n    let cut = Math.max(\n      slice.lastIndexOf(\"\\n\\n\"),\n      slice.lastIndexOf(\". \"),\n      slice.lastIndexOf(\"\\n\"),\n      slice.lastIndexOf(\" \")\n    );\n    if (cut < max * 0.6) cut = max; // fallback: hard cut\n    out.push(rest.slice(0, cut).trim());\n    rest = rest.slice(cut).trimStart();\n  }\n  out.push(rest);\n  return out;\n}\n\n// Support multiple incoming items (future-proof)\nconst items = $input.all();\nconst results = [];\n\nfor (const item of items) {\n  const text = item.json.reply ?? item.json.message?.content ?? item.json.response ?? \"\";\n  const chunks = splitSmart(text, MAX);\n\n  // (Optional) handle unfinished markdown code blocks across cuts\n  let inFence = false;\n  for (let i = 0; i < chunks.length; i++) {\n    let c = chunks[i];\n    // basic fence parity check\n    const fenceCount = (c.match(/```/g) || []).length;\n    if (inFence) {\n      // ensure the continuation opens with a fence\n      if (!c.startsWith(\"```\")) c = \"```\\n\" + c;\n    }\n    inFence = (inFence ? fenceCount % 2 === 0 ? true : false : fenceCount % 2 === 1);\n    if (inFence && i === chunks.length - 1) {\n      // close an open fence on the final chunk\n      c = c + \"\\n```\";\n      inFence = false;\n    }\n\n    results.push({\n      json: {\n        ...item.json,\n        chunk: c\n      }\n    });\n  }\n}\n\nreturn results;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        480,
        320
      ],
      "id": "0449a31f-7bf3-4a93-b6ab-c13870491469",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "{\n  \"parameters\": {\n    \"keepOnlySet\": false,\n    \"values\": {\n      \"string\": [\n        {\n          \"name\": \"chatId\",\n          \"value\": \"={{$json.chatId}}\"\n        }\n      ]\n    }\n  },\n  \"name\": \"Carry chatId\",\n  \"type\": \"n8n-nodes-base.set\",\n  \"typeVersion\": 2,\n  \"position\": [460, 120]\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -288,
        272
      ],
      "id": "76faa02a-58d1-43c9-8990-2fa04788b7be",
      "name": "Carry chatId"
    },
    {
      "parameters": {
        "jsCode": "// Loop over input items and add a new field called 'myNewField' to the JSON of each one\nfor (const item of $input.all()) {\n  item.json.myNewField = 1;\n}\n\nreturn $input.all();\n// Normalize Reply (after HTTP)\nconst chatId = $items('Join Memory', 0, 0).json.chatId;\nconst reply  = $json.reply || $json.messages || $json.message || '';\nreturn [{ json: { reply, chatId } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        224,
        272
      ],
      "id": "ea58a0c7-0f64-4307-9902-dc5c305ad3b4",
      "name": "Normalize Output"
    },
    {
      "parameters": {
        "jsCode": "const chatId =\n  $json.chatId ||\n  $items('Join Memory', 0, 0)?.[0]?.json?.chatId || null;\n\nif ($json.chunk)    return [{ json: { message: $json.chunk, chatId } }];\nif ($json.reply)    return [{ json: { message: $json.reply, chatId } }];\nif ($json.messages) return [{ json: { message: $json.messages, chatId } }];\nreturn [{ json: { message: 'âš ï¸ No reply generated', chatId } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        672,
        320
      ],
      "id": "74189998-4953-419b-82dd-8f4403f0b159",
      "name": "Return to Master"
    },
    {
      "parameters": {
        "chatId": "={{$node[\"Telegram Trigger\"].json[\"message\"][\"chat\"][\"id\"]}}",
        "text": "={{$json.message}}",
        "additionalFields": {}
      },
      "id": "39c3c6d9-8dd5-41ab-a3ea-d8b5039badf6",
      "name": "Telegram â†’ Send Message",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        1392,
        -80
      ],
      "webhookId": "e375552c-7d5f-4551-b6d9-3274da2467d4",
      "credentials": {
        "telegramApi": {
          "id": "ZVzTrMIuVWfKbh71",
          "name": "Spiffy-Telegram"
        }
      }
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "{\n  \"parameters\": {\n    \"keepOnlySet\": false,\n    \"values\": {\n      \"string\": [\n        {\n          \"name\": \"chatId\",\n          \"value\": \"={{$json.chatId}}\"\n        }\n      ]\n    }\n  },\n  \"name\": \"Carry chatId\",\n  \"type\": \"n8n-nodes-base.set\",\n  \"typeVersion\": 2,\n  \"position\": [460, 120]\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        352,
        -416
      ],
      "id": "cb1f6532-8ee8-4279-a18a-8f174337f579",
      "name": "Carry chatId1"
    },
    {
      "parameters": {
        "jsCode": "// Safely fetch chatId from \"Parse Message\" (works even if this node is executed alone)\nconst pm = $items('Parse Message', 0, 0);\nconst chatId =\n  (pm && pm[0] && pm[0].json && pm[0].json.chatId) ||\n  $json.chatId ||\n  null;\n\n// Each item from Airtable is one row\nconst rows = items.map(i => i.json);\nconst flat = rows.map(r => r.fields ? r.fields : r);\n\nif (!flat.length) {\n  return [{ json: { message: 'No commands found in Airtable.', chatId } }];\n}\n\n// Build lines: \"â€¢ command â€” description\"\nconst lines = flat.map(r => {\n  const cmd = r.Command || '(no command)';\n  const desc = r.Help || r.Category || '';\n  return `â€¢ ${cmd} â€” ${desc}`;\n});\n\nconst message = '*Available Commands:*\\n' + lines.join('\\n');\n\nreturn [{ json: { message, chatId } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        608,
        -416
      ],
      "id": "5de03821-8fa2-4729-b073-ca9c7f324cde",
      "name": "Format List"
    },
    {
      "parameters": {
        "jsCode": "// Items may be real Airtable rows, or a passthrough item (when Always Output Data is ON)\nconst rows = items.map(i => i.json);\n\n// If rows came from Airtable, theyâ€™ll be under .fields\nconst flat = rows.map(r => r.fields ? r.fields : r);\n\n// Keep only real memory records (have Topic + Summary)\nconst mems = flat.filter(r => r.Topic && r.Summary);\n\n// Take up to 5 and build bullets\nconst bullets = mems.slice(0, 5).map(m => `- ${m.Topic}: ${m.Summary}`);\nconst memoryContext = bullets.length ? bullets.join('\\n') : '';\n\n// Carry chatId + text forward\nconst pm = $items('Parse Message', 0, 0);\nconst chatId = pm?.[0]?.json?.chatId ?? $json.chatId ?? null;\nconst text   = pm?.[0]?.json?.text   ?? $json.text   ?? '';\n\nreturn [{ json: { chatId, text, memoryContext } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -32,
        272
      ],
      "id": "e5191ae9-8dd8-4df5-98d9-32910c66b9a3",
      "name": "Join Memory"
    },
    {
      "parameters": {
        "operation": "search",
        "base": {
          "__rl": true,
          "value": "appTxK7lxuhWmaadj",
          "mode": "list",
          "cachedResultName": "Spiffy OS",
          "cachedResultUrl": "https://airtable.com/appTxK7lxuhWmaadj"
        },
        "table": {
          "__rl": true,
          "value": "tbl5eoUZbRNiI2Gyw",
          "mode": "list",
          "cachedResultName": "Memory",
          "cachedResultUrl": "https://airtable.com/appTxK7lxuhWmaadj/tbl5eoUZbRNiI2Gyw"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        -160,
        272
      ],
      "id": "8b4ac3b3-a30b-43b4-a8db-33368607fd66",
      "name": "Fetch Memory",
      "alwaysOutputData": true,
      "credentials": {
        "airtableTokenApi": {
          "id": "yfOqFYwVkXZmE1LS",
          "name": "Airtable Personal Access Token account"
        }
      }
    },
    {
      "parameters": {
        "operation": "search",
        "base": {
          "__rl": true,
          "value": "appTxK7lxuhWmaadj",
          "mode": "list",
          "cachedResultName": "Spiffy OS",
          "cachedResultUrl": "https://airtable.com/appTxK7lxuhWmaadj"
        },
        "table": {
          "__rl": true,
          "value": "tblqcjZpU2VFD3rTY",
          "mode": "list",
          "cachedResultName": "Logs (chat I/O)",
          "cachedResultUrl": "https://airtable.com/appTxK7lxuhWmaadj/tblqcjZpU2VFD3rTY"
        },
        "filterByFormula": "=",
        "returnAll": false,
        "limit": 30,
        "options": {},
        "sort": {
          "property": [
            {
              "field": "timestamp",
              "direction": "desc"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        -160,
        128
      ],
      "id": "a7bf25d5-ca3e-4ff6-b232-69d129f661da",
      "name": "Fetch Recent Logs",
      "alwaysOutputData": true,
      "credentials": {
        "airtableTokenApi": {
          "id": "yfOqFYwVkXZmE1LS",
          "name": "Airtable Personal Access Token account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const pm = $items('Parse Message', 0, 0)[0].json;\nconst chatId = pm.chatId;\nconst hint = (pm.args || '').trim(); // user may write: remember project x\n\n// Flatten Airtable rows\nconst flat = items.map(i => i.json.fields ? i.json.fields : i.json);\n\n// Take up to 30 most recent\nconst recent = flat.slice(0, 30);\n\n// Build a simple transcript (Input â†’ Output pairs when available)\nconst lines = recent.map(r => {\n  const t = (r.Input || r.input || '').trim();\n  const o = (r.Output || r.output || '').trim();\n  if (t && o) return `User: ${t}\\nSpiffy: ${o}`;\n  return t ? `User: ${t}` : o ? `Spiffy: ${o}` : '';\n}).filter(Boolean);\n\nconst transcript = lines.join('\\n\\n');\n\nreturn [{\n  json: {\n    chatId,\n    hint,\n    transcript\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -32,
        128
      ],
      "id": "54609e2d-d245-4af7-8f5d-ded6c8c0391a",
      "name": "Join Logs For Summary"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://ollama:11434/api/chat",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{$json}}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        224,
        128
      ],
      "id": "eb471ece-deb6-4bb1-8ea2-dd0ae635cc55",
      "name": "HTTP Request",
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "jsCode": "const topic = $json.Topic ?? 'new memory';\n\nreturn [\n  {\n    json: {\n      message: `ðŸ§  Saved memory: ${topic}`\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        752,
        128
      ],
      "id": "3dbd2927-9344-42b9-9002-cb4b750177d6",
      "name": "Format Remember Ack"
    },
    {
      "parameters": {
        "jsCode": "const transcript = $json.transcript || \"\";\n\nconst prompt = `System:\nYou are a precise memory extractor. From the user's message, output ONLY JSON that captures stable, reusable facts. Do not write prose. Never invent.\n\nRules:\n- Output schema exactly: {\"memories\":[{\"key\":\"\",\"value\":\"\",\"category\":\"\",\"entity\":\"\",\"summary\":\"\",\"confidence\":0-1,\"tags\":[]}]}\n- key = snake_case identifier (e.g., \"favorite_color\", \"pet_dog_name\")\n- value = the literal fact (e.g., \"pink\", \"Baron\")\n- category âˆˆ {preference, personal, contact, pet, profile, other}\n- entity = \"Gabi\" unless otherwise clear\n- summary = one short sentence with names/values\n- tags = short nouns ([\"profile\",\"pet\"]) â€“ keep â‰¤ 5\n- confidence: 0.0â€“1.0 based on certainty from the message\n- Include only concrete facts. If unsure, omit.\n\n[Transcript]\n${transcript}\n`;\n\nreturn [\n  {\n    json: {\n      model: \"spiffy:latest\",\n      messages: [\n        { role: \"user\", content: prompt }\n      ],\n      stream: false,\n      options: { keep_alive: \"2h\", num_thread: 4 }\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        96,
        128
      ],
      "id": "62832673-55f7-4d02-8d40-1684279b7fc0",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "{\n  \"parameters\": {\n    \"keepOnlySet\": false,\n    \"values\": {\n      \"string\": [\n        {\n          \"name\": \"chatId\",\n          \"value\": \"={{$json.chatId}}\"\n        }\n      ]\n    }\n  },\n  \"name\": \"Carry chatId\",\n  \"type\": \"n8n-nodes-base.set\",\n  \"typeVersion\": 2,\n  \"position\": [460, 120]\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -288,
        128
      ],
      "id": "1a41b97e-603d-4b4e-8765-9c578a44c962",
      "name": "Carry chatId2"
    },
    {
      "parameters": {
        "jsCode": "// 1) Keep chatId safe\nconst chatId =\n  $json.chatId ||\n  $items('Join Logs For Summary', 0, 0)?.json?.chatId ||\n  $items('Parse Message', 0, 0)?.json?.chatId ||\n  null;\n\n// 2) Get model text from common places (Ollama /chat style or generic)\nlet text =\n  $json.message?.content ||\n  $json.response?.choices?.[0]?.message?.content ||\n  $json.reply || $json.messages || $json.message || $json.output || '';\n\n// Ensure string\ntext = typeof text === 'string' ? text : JSON.stringify(text || '');\n\n// 3) Try to extract a JSON object (handles ```json ... ``` and bare {...})\nfunction extractJsonBlock(s) {\n  // fenced ```json â€¦ ```\n  const fence = s.match(/```json\\s*([\\s\\S]*?)```/i);\n  if (fence) return fence[1];\n  // any {...} block\n  const braces = s.match(/\\{[\\s\\S]*\\}/);\n  if (braces) return braces[0];\n  return null;\n}\n\nlet obj = null;\nconst maybe = extractJsonBlock(text);\nif (maybe) {\n  try { obj = JSON.parse(maybe); } catch (_) {}\n}\n\n// 4) If no JSON, fall back to line parsing like \"Topic: X\", etc.\nfunction pull(label, s) {\n  const re = new RegExp(`^\\\\s*${label}\\\\s*:\\\\s*(.+)$`, 'im');\n  const m = s.match(re);\n  return m ? m[1].trim() : '';\n}\n\nlet Topic = obj?.Topic || pull('Topic', text);\nlet Summary = obj?.Summary || pull('Summary', text);\nlet Importance = (obj?.Importance || pull('Importance', text) || 'Medium').trim();\n\n// 5) Final fallbacks\nif (!Topic) Topic = $items('Join Logs For Summary', 0, 0)?.json?.hint || 'Conversation summary';\nif (!Summary) {\n  // use the first 1200 chars of the model text as a crude fallback\n  Summary = text.slice(0, 1200);\n}\n// Normalize Importance to allowed values\nconst imp = Importance.toLowerCase();\nif (imp.startsWith('h')) Importance = 'High';\nelse if (imp.startsWith('l')) Importance = 'Low';\nelse Importance = 'Medium';\n\n// 6) Coerce to strings (prevents [object Object] in Airtable)\nTopic = String(Topic);\nSummary = String(Summary);\n\n// 7) Date for Airtable\nconst LastMentioned = new Date().toISOString().slice(0, 10);\n\n// 8) Output\nreturn [{\n  json: { Topic, Summary, Importance, LastMentioned, chatId, _rawModelText: text }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        352,
        128
      ],
      "id": "ed2039f7-5bfd-4272-aa9e-a430ebe6c00c",
      "name": "Meaningful Memory"
    },
    {
      "parameters": {
        "jsCode": "// --- carry chatId safely (optional) ---\nconst chatId =\n$json.chatId ||\n$items('Join Logs For Summary', 0, 0)?.json?.chatId ||\n$items('Parse Message', 0, 0)?.json?.chatId ||\nnull;\n\nreturn [\n  {\n    json: {\n      unique_key: \"gabi::favorite_color\",\n      key: \"favorite_color\",\n      value: \"pink\",\n      summary: \"Gabi's favorite color is pink.\",\n      category: \"preference\",\n      entity: \"Gabi\",\n      confidence: 0.99,\n      last_mentioned: new Date().toISOString(),\n      tags: [\"profile\",\"color\"],\n      source_ids: [\"telegram:12345\"]\n    }\n  },\n  {\n    json: {\n      unique_key: \"gabi::pet_dog_name\",\n      key: \"pet_dog_name\",\n      value: \"Baron\",\n      summary: \"Gabi's dog is named Baron.\",\n      category: \"pet\",\n      entity: \"Gabi\",\n      confidence: 0.99,\n      last_mentioned: new Date().toISOString(),\n      tags: [\"pet\",\"dog\"],\n      source_ids: [\"telegram:12345\"]\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        480,
        128
      ],
      "id": "171cddad-714a-4383-9315-14e2b03df03f",
      "name": "Extract Memory JSON"
    },
    {
      "parameters": {
        "operation": "create",
        "base": {
          "__rl": true,
          "value": "appTxK7lxuhWmaadj",
          "mode": "list",
          "cachedResultName": "Spiffy OS",
          "cachedResultUrl": "https://airtable.com/appTxK7lxuhWmaadj"
        },
        "table": {
          "__rl": true,
          "value": "tbl5eoUZbRNiI2Gyw",
          "mode": "list",
          "cachedResultName": "Memory",
          "cachedResultUrl": "https://airtable.com/appTxK7lxuhWmaadj/tbl5eoUZbRNiI2Gyw"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "summary": "={{ $json.summary }}",
            "last_mentioned": "={{ $json.last_mentioned }}",
            "tags": "={{ $json.tags }}",
            "key": "={{ $json.key }}",
            "value": "={{ $json.value }}",
            "category": "={{ $json.category }}",
            "entity": "={{ $json.entity }}",
            "confidence": "={{ $json.confidence }}",
            "source_ids": "={{ $json.source_ids }}",
            "chat_id": 0
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "topic",
              "displayName": "topic",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "summary",
              "displayName": "summary",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "memory",
              "displayName": "memory",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "tags",
              "displayName": "tags",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "array",
              "options": [
                {
                  "name": "robot",
                  "value": "robot"
                },
                {
                  "name": "companion",
                  "value": "companion"
                },
                {
                  "name": "information",
                  "value": "information"
                },
                {
                  "name": "organization",
                  "value": "organization"
                },
                {
                  "name": "snark",
                  "value": "snark"
                },
                {
                  "name": "communication",
                  "value": "communication"
                },
                {
                  "name": "guidelines",
                  "value": "guidelines"
                },
                {
                  "name": "companion robot",
                  "value": "companion robot"
                },
                {
                  "name": "personality",
                  "value": "personality"
                }
              ],
              "readOnly": false,
              "removed": false
            },
            {
              "id": "last_mentioned",
              "displayName": "last_mentioned",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "dateTime",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "importance",
              "displayName": "importance",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "options",
              "options": [
                {
                  "name": "Low",
                  "value": "Low"
                },
                {
                  "name": "Medium",
                  "value": "Medium"
                },
                {
                  "name": "High",
                  "value": "High"
                },
                {
                  "name": "=Medium",
                  "value": "=Medium"
                }
              ],
              "readOnly": false,
              "removed": false
            },
            {
              "id": "source",
              "displayName": "source",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "chat_id",
              "displayName": "chat_id",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "unique_key",
              "displayName": "unique_key",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": false
            },
            {
              "id": "key",
              "displayName": "key",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "value",
              "displayName": "value",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "category",
              "displayName": "category",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "options",
              "options": [
                {
                  "name": "preference",
                  "value": "preference"
                },
                {
                  "name": "personal",
                  "value": "personal"
                },
                {
                  "name": "contact",
                  "value": "contact"
                },
                {
                  "name": "pet",
                  "value": "pet"
                },
                {
                  "name": "profile",
                  "value": "profile"
                },
                {
                  "name": "other",
                  "value": "other"
                }
              ],
              "readOnly": false,
              "removed": false
            },
            {
              "id": "entity",
              "displayName": "entity",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "confidence",
              "displayName": "confidence",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "first_seen",
              "displayName": "first_seen",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "dateTime",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "source_ids",
              "displayName": "source_ids",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {
          "typecast": true
        }
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        608,
        128
      ],
      "id": "934bb49e-d39e-443f-8bf0-c007776ec917",
      "name": "Create a record",
      "alwaysOutputData": true,
      "credentials": {
        "airtableTokenApi": {
          "id": "yfOqFYwVkXZmE1LS",
          "name": "Airtable Personal Access Token account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "Parse Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Message": {
      "main": [
        [
          {
            "node": "Airtable: Log (In)",
            "type": "main",
            "index": 0
          },
          {
            "node": "Route Kind",
            "type": "main",
            "index": 0
          },
          {
            "node": "Send Chat Action (typing)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Airtable: List Commands",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Format Help/Status",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Format Help/Status",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Airtable: Create Task",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Airtable: Find Personality",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Carry chatId2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Airtable: Find Personality": {
      "main": [
        [
          {
            "node": "Format Switch Personality",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Switch Personality": {
      "main": [
        [
          {
            "node": "Telegram â†’ Send Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Airtable: Log (In)": {
      "main": [
        []
      ]
    },
    "Airtable: List Commands": {
      "main": [
        [
          {
            "node": "Carry chatId1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Help/Status": {
      "main": [
        [
          {
            "node": "Telegram â†’ Send Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Airtable: Create Task": {
      "main": [
        [
          {
            "node": "Format Task Created",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Task Created": {
      "main": [
        [
          {
            "node": "Telegram â†’ Send Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Route Kind": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Carry chatId",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP â†’ Ollama (chat)": {
      "main": [
        [
          {
            "node": "Normalize Output",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set â†’ reply": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Return to Master",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Normalize Output": {
      "main": [
        [
          {
            "node": "Set â†’ reply",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Carry chatId": {
      "main": [
        [
          {
            "node": "Fetch Memory",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Return to Master": {
      "main": [
        [
          {
            "node": "Telegram â†’ Send Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram â†’ Send Message": {
      "main": [
        []
      ]
    },
    "Carry chatId1": {
      "main": [
        [
          {
            "node": "Format List",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format List": {
      "main": [
        [
          {
            "node": "Telegram â†’ Send Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Join Memory": {
      "main": [
        [
          {
            "node": "HTTP â†’ Ollama (chat)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Memory": {
      "main": [
        [
          {
            "node": "Join Memory",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Recent Logs": {
      "main": [
        [
          {
            "node": "Join Logs For Summary",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Join Logs For Summary": {
      "main": [
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Meaningful Memory",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Remember Ack": {
      "main": [
        [
          {
            "node": "Telegram â†’ Send Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Carry chatId2": {
      "main": [
        [
          {
            "node": "Fetch Recent Logs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Meaningful Memory": {
      "main": [
        [
          {
            "node": "Extract Memory JSON",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Memory JSON": {
      "main": [
        [
          {
            "node": "Create a record",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create a record": {
      "main": [
        [
          {
            "node": "Format Remember Ack",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "1ae4602b-a7a1-481b-a7a1-156f06753edc",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "a7beee7e0880fab8ba471b4d47a0d809dab332ab21ca93b255aea19da323d2e6"
  },
  "id": "4qooK4l5mZ3Lyka1",
  "tags": []
}